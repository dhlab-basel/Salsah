<!-- the user form starts with a button, which will open a dialog box with the user create form -->

<button mat-button (click)="addNewUser()">
    <mat-icon>add</mat-icon>
    <span> Add new person </span>
</button>


<!-- this form has a multi-step form interface
    it will be displayed in dialog card box -->

<!-- the dialog title is always the same; It stays fixed to the top of the dialog -->
<div mat-dialog-title>
    <salsah-progress-stepper *ngIf="steps || max_steps" [steps]="steps" [counter]="counter"></salsah-progress-stepper>
</div>

<!-- the new user form assistant starts with a user selection field (autocomplete) to look for an existing user first -->
<div mat-dialog-content>

    <!-- Step 0: Select resource type from a list of resources taken directly from the Knora base ontology
        (How do we include other ontologies / other properties? Do we simply read all possible resources within all ontologies?) -->
    <section [hidden]="counter!==0">


        <hr>
        <!-- form to create a new user or to edit an old one from selection above -->
        <form class="salsah-form new-user" [formGroup]="uf" (ngSubmit)="onSubmit(uf.value, uf.valid)">
            <mat-input-container class="half-width"
                                dividerColor="{{ uf.controls['firstName']?.invalid && uf.controls['firstName']?.touched ? 'warn' : 'primary' }}">
                <input matInput
                       disabled
                       [placeholder]="form.user.firstName + ' *'"
                       [formControl]="uf.controls['givenName']">
            </mat-input-container>

            <mat-input-container class="half-width"
                                dividerColor="{{ uf.controls['lastName']?.invalid && uf.controls['lastName']?.touched ? 'warn' : 'primary' }}">
                <input matInput
                       disabled="disabled"
                       [placeholder]="form.user.lastName + ' *'"
                       [formControl]="uf.controls['familyName']">
            </mat-input-container>

            <mat-input-container class="full-width"
                                dividerColor="{{ uf.controls['email']?.invalid && uf.controls['email']?.touched ? 'warn' : 'primary' }}">
                <input matInput type="email"
                       [placeholder]="form.user.email + ' *'"
                       [formControl]="uf.controls['email']">
                <mat-hint class="salsah-hint">
                    <span [hidden]="uf.controls['email'].invalid">{{form.user.emailHint}}</span>
                    <span
                            [hidden]="uf.controls['email'].valid && uf.controls['email'].dirty || !uf.controls['email'].touched"
                            class="salsah-error">{{form.user.emailValidation}}
                </span>
                </mat-hint>
            </mat-input-container>

            <mat-input-container class="full-width"
                                dividerColor="{{ !uf.controls['password']?.valid ? 'warn' : 'primary' }}">
                <input matInput type="password"
                       [placeholder]="form.user.password + ' *'"
                       [formControl]="uf.controls['password']">
                <mat-hint class="salsah-hint">
                    <!-- [hidden]="uf.controls['password'].valid" [ngClass]="{'salsah-error': (uf.controls['password'].invalid && uf.controls['password'].dirty)}"  -->
                    <span
                            [hidden]="uf.controls['password'].valid && uf.controls['password'].dirty || !uf.controls['password'].touched"
                            class="salsah-error">
                                        {{form.user.passwordHint}}
                                    </span>
                </mat-hint>
            </mat-input-container>

            <table class="full-width form-table">
                <tr>
                    <td class="left">
                        <mat-select [formControl]="uf.controls['lang']" [placeholder]="form.user.language"
                                   [(ngModel)]="uf.controls['lang'].value">
                            <mat-option value="en">english</mat-option>
                            <mat-option value="de">deutsch</mat-option>
                            <mat-option value="fr">fran√ßais</mat-option>
                            <mat-option value="it">italiano</mat-option>
                        </mat-select>
                    </td>

                    <td class="right">
                        <mat-checkbox align="end">
                            {{form.user.admin}}
                        </mat-checkbox>
                    </td>
                </tr>
            </table>
        </form>
    </section>
</div>


<div mat-dialog-actions>
    <button mat-button
            mat-dialog-close
            class="cancel-button">
        Cancel
    </button>
    <span class="fill-remaining-space"></span>

    <span class="back">
        <button mat-button
                *ngIf="counter < max_steps && counter > 0"
                class="back-button"
                (click)="prevFormSection(counter, $event)">
                <mat-icon>keyboard_arrow_left</mat-icon> Back
        </button>
    </span>

    <!-- a button to go forward is on the right side; at the end it will be replaced with the submit button -->
    <span class="next">
        <button mat-raised-button
                [disabled]="!newResource.label"
                *ngIf="counter < (max_steps - 1) && counter > 0"
                class="next-button"
                [color]="'primary'"
                (click)="nextFormSection(counter, $event)">
            Next <mat-icon>keyboard_arrow_right</mat-icon>
        </button>
        <!-- or -->
        <button type="submit"
                mat-raised-button
                *ngIf="counter === (max_steps - 1)"
                class="save-button"
                color="primary"
                (click)="onSubmit(rcf.value)"
                [disabled]="!rcf.valid">
            Save
        </button>
    </span>

</div>

<!--
<form class="salsah-form user-form" [formGroup]="uf" (ngSubmit)="onSubmit(uf.value, uf.valid)" mat-card>

    <div mat-dialog-title>
        {{form.user.title}}
    </div>
    <div mat-dialog-content>

    <div mat-dialog-actions>
        <span>
            <button mat-button
                    class="cancel-button"
                    (click)="closeForm($event)">
                Cancel
            </button>
        </span>
        <span class="fill-remaining-space"></span>
        <span>
            <button type="submit"
                    [disabled]="!uf.valid || uf.errors"
                    mat-raised-button
                    class="save-button mat-primary">
                Save
            </button>
        </span>
    </div>

</form>
-->
